# Развертка окружения на основе Docker контейнеров

Требуются установленные пакеты Docker Compose 1.6.0+ и Docker 1.10.0+ (желательно ставить последние стабильные версии)
## Развертка
1. Клонируем репозиторий
2. В корне есть пример (docker-compose.example.yaml) копируем его в корень с именем docker-compose.yaml
3. В файле docker-compose.yaml изменяем в блоке services > nginx > ports на тот ip на котором будет висеть nginx например 172.20.0.4:80:80 (в конце :80 не случайно дважды последние :80 не проавить). Также при необходимости меняем в блоке services > nginx > environment меням значение FRONTEND_URL на домен по которому будет достпен проект локально (например kasperskiy-rewards.ld). Далее в файл /etc/hosts добавляем запись вида "172.20.0.4 kasperskiy-rewards.ld admin.kasperskiy-rewards.ld"
4. Если не требуетсья phpmyadmin можно удалить этот блок (что сэкономит время при развертке), если его оставить phpmyadmin будет доступен localhost:8080
5. Контейнеры запускаються и останавливаются командами

~~~bash
docker-compose up -d
~~~

и

~~~bash
docker-compose stop
~~~

соответсвенно выполнямые в корне проекта.
6. При первом запуске будет долгая развертка (зависит от производительности железа) которая подтяенет все необходимое для запуска окружения на основе докер контейнеров.
7. Менеджер зависимостей composer доступен при помощи команды

~~~bash
docker-compose run php-composer
~~~

 например для установки пакетов достаточно выполнить в корне проекта

~~~bash
docker-compose run php-composer install
~~~

8. Войти в php-cli консоль  можно командой

~~~bash
docker-compose exec php-cli sh
~~~
9. После этого необходимо развернуть конфигурацию командой
~~~bash
php init
~~~
 и выбрать Docker Development
10. Также применяються и миграции и остальные консольные команды в php-cli окружении например
~~~bash
php yii migrate/up
~~~

11. Mysql будет доступен на 172.20.0.3:3306 принеобходимости можно сменить на нужное.
Пример заливки дампа
~~~bash
mysql -u dev -p -h 172.20.0.3 dev < dump.sql
~~~
Данные с которыми инициализируется mysql по дефолту
~~~
Логин: dev
Пароль: dev
Имя базы: dev
Пароль от root: toor
~~~

12. Фронт и бекенд точки входа будут доступны по kasperskiy-rewards.ld и admin.kasperskiy-rewards.ld
